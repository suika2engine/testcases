Automatic Testing Framework for Suika2
======================================

## Running Tests
Please run the following command in the root directory of Suika2 source code.
```
make test
```

## Our Testing Framework
A test case is created when a new feature is added.
We capture logs by `suika-capture.exe` and save it as a new test case.

Each test case is executed by `suika-replay.exe`.
We can detect bugs by the difference of the answer and the result screenshots.

When a commit is pushed to GitHub, automatic testing is done by GitHub Actions.
Throughout this process, we can detect regression bugs immediately when they get into `Suika2`.

This is a very advanced technology in software testing field.
It is a testing technique called capture-and-replay.
Since spreadsheets are used to write test cases,
this could be included in a technique called keyword-driven testing.
Please search for research papers as it is difficult to find books in this area.

## `suika-capture.exe`
`suika-capture.exe` is a tool that records all user operations.
It creates a CSV file that contains all user interactions, as well as screenshot files.

A recorded CSV file becomes our test case.
We can replay it by `suika-replay.exe`.

By comparing the screenshots, we can check for regression bugs.

## `suika-replay.exe`
`suika-replay.exe` replays a CSV file that is generated by `suika-capture.exe`.
In our CI, we use the Linux version of `suika-replay` instead of `suika-replay.exe`.

## Adding a Test
Multiple test cases belong to a single game data.

To add a game data, please follow these instructions:
* Create a `.data` folder such as `001-sample-jp.data`
* Put your game folder as `game` such as `001-sample-jp.data/game`
* Run `git add`, `git commit` and `git push`

To add a test case, please follow these instructions:
* Run your game by `suika-capture.exe` on Windows
  * This will generate `record` folder
  * `record` folder includes screenshots, but we don't use them directly
* Create a test case folder as `.record` in a `.data` folder such as `001-sample-jp.data/001-my-test-case.record`
* Copy generated `record/main.csv` to `.data` folder you created
* Run `update-answers.sh` on Linux
  * This script generates screenshots that rounding errors of GPU shaders are normalized
  * This script also compresses the answer images to WEBP files
* Run `git add`, `git commit` and `git push`
